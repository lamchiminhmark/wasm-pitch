!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.WasmPitch=e():t.WasmPitch=e()}(self,(function(){return(()=>{"use strict";var t,e,i,o,r={},s={};function n(t){var e=s[t];if(void 0!==e)return e.exports;var i=s[t]={exports:{}};return r[t](i,i.exports,n),i.exports}n.m=r,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,n.t=function(i,o){if(1&o&&(i=this(i)),8&o)return i;if("object"==typeof i&&i){if(4&o&&i.__esModule)return i;if(16&o&&"function"==typeof i.then)return i}var r=Object.create(null);n.r(r);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&o&&i;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>i[t]));return s.default=()=>i,n.d(r,s),r},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce(((e,i)=>(n.f[i](t,e),e)),[])),n.u=t=>t+".index.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i={},o="WasmPitch:",n.l=(t,e,r,s)=>{if(i[t])i[t].push(e);else{var a,c;if(void 0!==r)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var l=d[u];if(l.getAttribute("src")==t||l.getAttribute("data-webpack")==o+r){a=l;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",o+r),a.src=t),i[t]=[e];var h=(e,o)=>{a.onerror=a.onload=null,clearTimeout(f);var r=i[t];if(delete i[t],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((t=>t(o))),e)return e(o)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),(()=>{var t={179:0};n.f.j=(e,i)=>{var o=n.o(t,e)?t[e]:void 0;if(0!==o)if(o)i.push(o[2]);else{var r=new Promise(((i,r)=>o=t[e]=[i,r]));i.push(o[2]=r);var s=n.p+n.u(e),a=new Error;n.l(s,(i=>{if(n.o(t,e)&&(0!==(o=t[e])&&(t[e]=void 0),o)){var r=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,o[1](a)}}),"chunk-"+e,e)}};var e=(e,i)=>{var o,r,[s,a,c]=i,d=0;for(o in a)n.o(a,o)&&(n.m[o]=a[o]);for(c&&c(n),e&&e(i);d<s.length;d++)r=s[d],n.o(t,r)&&t[r]&&t[r][0](),t[s[d]]=0},i=self.webpackChunkWasmPitch=self.webpackChunkWasmPitch||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var a={};n.r(a),n.d(a,{default:()=>d});var c=function(t,e,i,o){return new(i||(i=Promise))((function(r,s){function n(t){try{c(o.next(t))}catch(t){s(t)}}function a(t){try{c(o.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}c((o=o.apply(t,e||[])).next())}))};class d{constructor(t="",e={}){this.mediaTrackOptions=e,this.callbacks=[],this.filterNodes=[],this.isRunning=!1,this.isLoaded=!1,this.isAudioInitialized=!1,this.initWasm(t)}get filteredNode(){return this.filterNodes.length?this.filterNodes[this.filterNodes.length-1]:this.sourceNode}initWasm(t){return c(this,void 0,void 0,(function*(){this.loadingPromise=new Promise(((e,i)=>c(this,void 0,void 0,(function*(){const o=yield n.e(323).then(n.t.bind(n,323,23));this.moduleObj=yield o({onRuntimeInitialized:()=>{this.isLoaded=!0,e()},onAbort:t=>{i("Loading of wasm-pitch aborted"),console.error(t)},locateFile:()=>t+"/wasm_interface.wasm"})}))))}))}init(t){return c(this,void 0,void 0,(function*(){if(t)this.audioContext=t.context,this.sourceNode=t;else{const t=new AudioContext;this.mediaStream=yield navigator.mediaDevices.getUserMedia({audio:this.mediaTrackOptions}),this.sourceNode=t.createMediaStreamSource(this.mediaStream),this.audioContext=t,this.createFilterNodes()}this.processorNode=this.audioContext.createScriptProcessor(1024,1,1),this.processorNode.onaudioprocess=t=>{const e=t.inputBuffer.getChannelData(0);let i;try{i=this.moduleObj._malloc(e.byteLength),this.moduleObj.HEAPF32.set(e,i>>2);const o=this.moduleObj._get_pitch_mpm_c(i,e.length,t.inputBuffer.sampleRate);this.callbacks.forEach((t=>t(o)))}catch(t){throw t}finally{this.moduleObj._free(i)}};try{return yield this.loadingPromise,this.isAudioInitialized=!0,this}catch(t){throw t}}))}createFilterNodes(){if(this.mediaTrackOptions.lowCutFrequencyHz||this.mediaTrackOptions.highCutFrequencyHz){if(this.mediaTrackOptions.lowCutFrequencyHz){const t=this.audioContext.createBiquadFilter();t.type="highpass",t.frequency.value=this.mediaTrackOptions.lowCutFrequencyHz,t.Q.value=this.mediaTrackOptions.filterQualityFactor||1,this.filterNodes.push(t)}if(this.mediaTrackOptions.highCutFrequencyHz){const t=this.audioContext.createBiquadFilter();t.type="lowpass",t.frequency.value=this.mediaTrackOptions.highCutFrequencyHz,t.Q.value=this.mediaTrackOptions.filterQualityFactor||1,this.filterNodes.push(t)}}}getAudioContext(){return this.audioContext}start(){if(!this.isLoaded||!this.isAudioInitialized)throw Error("Must await WasmPitch.init() before calling start.");const t=[this.sourceNode,...this.filterNodes,this.processorNode,this.audioContext.destination];console.log("signal chain",t),t.reduce(((t,e)=>(t.connect(e),e))),this.isRunning=!0}stop(){if(this.isRunning=!1,!this.isLoaded||!this.isAudioInitialized)throw Error("Must await WasmPitch.init() before calling stop.");if(!this.processorNode)throw Error("start() has not been called");this.mediaStream&&this.mediaStream.getTracks()[0].stop(),[this.sourceNode,...this.filterNodes,this.processorNode,this.audioContext.destination].forEach((t=>t.disconnect()))}addListener(t){this.callbacks.push(t)}removeListener(t){const e=this.callbacks.indexOf(t);return-1!==e&&(this.callbacks.splice(e,1),!0)}}return a})()}));